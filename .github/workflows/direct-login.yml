name: üöÄ Direct Teacher Login Test

on:
  push:
    branches: [KB-Shubham, KB-ShubhamB]

jobs:
  login:
    runs-on: ubuntu-latest
    
    steps:
    - name: üîê Test Login Directly
      env:
        USER: "srandive245@gmail.com"
        PASS: "Kingsr@08"
      run: |
        echo "=== DIRECT LOGIN TEST START ==="
        
        # Method 1: Try direct POST to common login endpoints
        echo "üì§ Attempting direct login..."
        
        # Try common login endpoints
        ENDPOINTS=(
          "/api/login"
          "/login"
          "/auth/login"
          "/teacher/login"
          "/api/auth"
        )
        
        for endpoint in "${ENDPOINTS[@]}"; do
          echo "Trying: $endpoint"
          curl -s -X POST "https://universityadmissionmanage.vercel.app$endpoint" \
            -d "email=$USER&password=$PASS" \
            -H "Content-Type: application/x-www-form-urlencoded" \
            -w "Status: %{http_code}\n" \
            -o response.json
          
          if grep -q "success\|token\|dashboard" response.json 2>/dev/null; then
            echo "‚úÖ LOGIN SUCCESS via $endpoint!"
            exit 0
          fi
        done
        
        # Method 2: Check if already logged in (dashboard accessible)
        echo "üîç Checking dashboard access..."
        DASH_STATUS=$(curl -s -o /dev/null -w "%{http_code}" \
          "https://universityadmissionmanage.vercel.app/src/index.html")
        
        if [ "$DASH_STATUS" -eq 200 ]; then
          echo "‚úÖ Dashboard accessible (already logged in?)"
          exit 0
        fi
        
        # Method 3: Check login page exists
        echo "üìÑ Checking login page..."
        PAGE=$(curl -s "https://universityadmissionmanage.vercel.app/")
        if echo "$PAGE" | grep -q "login\|signin"; then
          echo "‚úÖ Login page exists"
        fi
        
        echo "‚ö†Ô∏è Note: Need browser automation for full login test"
        echo "=== TEST COMPLETE ==="